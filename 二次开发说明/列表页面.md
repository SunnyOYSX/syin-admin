## 初始

> 具体可以查看管理员页面 *src/views/system/admin.vue*

### 引入 mixins

```js
import {page as pageMixin} from "@/mixins/page.js";
import {table as tableMixin} from "@/mixins/table.js";
import {common as commonMixin} from "@/mixins/common.js";

// 合并
export default {
	mixins: [commonMixin, pageMixin, tableMixin],
}
```
commonMixin 封装各种常用操作

pageMixin 	封装分页基本操作

tableMixin 	封装表格基本操作

### 初始化

```js
data() {
	return {
		// 各跳转链接
		urls: {
			add: '/system/adminadd',
			del: '/system/admindel',
			dis: '/system/admindis',
			edit: '/system/adminedit/:id',
			list: '/system/adminlist',
			recycle: '/system/adminrecycle',
			sort: '/system/adminsort'
		},
	}
},
mounted(){
	this.addScene(this.urls.list);
	this.getRequestData();
},
```

### 设置分页组件

```html
<el-pagination
	@size-change="sizeChange"
	@current-change="pageChange"
	:current-page="page_default.current"
	:page-sizes="[10, 20, 30, 50]"
	:page-size="page_default.num"
	layout="total, sizes, prev, pager, next, jumper"
	:total="page_default.total">
</el-pagination>
```

## 分页

addScene 由 pageMixin 提供, 可提供多个页面请求

| 参数 | 参数说明 | 默认值 | 备注 |
| :----- | ----: | :----: | :----: |
| url 	  | 请求链接 | | 如果不是请求后台, 必须输入完整路径 |
| mapping  | 存储返回列表数据的根级响应式属性 | | |
| scene | 场景名称 | default |

### 多分页

> 具体可以查看数据字典页面  *src/views/system/dict.vue*

1. 引入多分页支持方法

	```js
	import {sence} from '@/libs/page.js';

	// ...

	this.addScene('/dict/list');
	// 新建一个名为 data 的场景
	this.addScene('/dict/dictdata', '', 'data');
	```

2. 设定多个分页的存储根元素

	```js
	data() {
		return {
			// 'page_' + 场景名称

			page_data: null
		}
	},
	```

3. 添加多分页方法

	```js
	methods: {
		defaultPage: sence('default'),
		dataPage: sence('data'),
	}
	```

4. 修改分页代码

	```html
	<el-pagination
		@size-change="defaultPage('sizeChange', $event)"
		@current-change="defaultPage('pageChange', $event)"
		:current-page="page_default.current"
		:page-sizes="[5, 10, 20, 30, 50]"
		:page-size="page_default.num"
		layout="total, sizes, prev, pager, next"
		:total="page_default.total">
	</el-pagination>
	```

	```html
	<el-pagination
		@size-change="dataPage('sizeChange', $event)"
		@current-change="dataPage('pageChange', $event)"
		:current-page="page_data.current"
		:page-sizes="[5, 10, 20, 30, 50]"
		:page-size="page_data.num"
		layout="total, sizes, prev, pager, next, jumper"
		:total="page_data.total">
	</el-pagination>
	```

5. 设置表格读取的分页数据

	```html
	<el-table :data="results">
	</el-table>
	```

	```html
	<el-table :data="page_data.results">
	</el-table>
	```

### 分页说明

**tableMixin 不支持多分页**, 如有需要, 请自行封装

分页数据存储在字段 `page_${场景}` 中, 如 page_default . 因vue不允许动态添加根级响应式属性, 所以其他场景需先手动添加根级响应式属性. 在页面上通过该根级响应式属性, 可获得分页场景的数据

如果在添加场景时, 设置了 mappping, 则该分页场景数据将存储 mapping 指定的根级响应式属性

多分页支持方法 sence, 需要传入分页场景, 返回一个函数 func, func 调用时接收至少一个参数, func 第一个参数必须为 mounted 中存在的方法名称, func 运行时首先切换场景, 再调用第一个参数里传入的方法, 并将其他参数按传顺序传入

	```
	// 在分页尺码改变时, 将先切换场景为 data, 再执行 sizeChange 方法
	@size-change="dataPage('sizeChange', $event)"
	```

## 表格操作

### 加载数据

```js
this.getRequestData();
```

### 接收选择项 ID

```html
<el-table
	@selection-change="selectionChange"
>
```

### 删除/禁用

| 操作 | 方法 | 参数1 | 参数2 | 参数3 | 备注 |
| :----- | ----: | :----: | :----: | :----: | :----: |
| 删除 | del | id | operate | | id = -1 表示批量操作, 为正整数为单个删除; operate 0: 恢复, 1: 删除 |
| 禁用 | disabled | id | operate | | id = -1 表示批量操作, 为正整数为单个删除; operate 0: 启用, 1: 禁用 |

```
@click="del(-1, 1)"

@click="disabled(scope.row.id, 1)" 
```

### 排序

```html
<!-- 排序按钮 -->
<el-button size="mini" type="success" icon="el-icon-sort" @click="sort">排序</el-button>

<!-- 排序模板 -->
<el-table-column label="排序" width="86">
	<template slot-scope="{row}">
		<el-input v-model="row.sort" type="number" size="mini" max="99" min="0"/>
	</template>
</el-table-column>
```

```js
data() {
	return {
		urls: {
			// 排序链接
			sort: '/system/adminsort'
		},
	}
},
```

## 封装表格操作

以排序为例

```js
let url = this.buildUrl('sort');
let data = this.extract('id, sort');
TableInstance.execute(url, data).then(res => {
	this.message('操作成功', 'success');
}).catch((e)=>{});
```

### 提取表格数据

```js
let data = this.extract('id, sort');
```

| 参数名 | 默认值 | 参数说明 | 备注 |
| :----- | ----: | :----: | :----: |
| fields  | | 需要提取数据的字段, 多个以 , 分隔 | 不传将返回id一维数组 |
| filter  | null | 自定义过滤器 | 当返回false时, 该项数据将不会加入提取数据中 |

### 数据提交

引入table.js

```js
import Table from '@/libs/Table.js';
```

实例化

```js
mounted() {
	this.instance = TableInstance = new Table(this);
},
```

执行请求

```js
TableInstance.execute(url, id, {operate}).then(res => {
}).catch((e)=>{});
```

execute 参数说明

| 参数名 | 默认值 | 参数说明 | 备注 |
| :----- | ----: | :----: | :----: |
| url  | | 提交链接 | |
| data | -1 | 提交的数据, 不限制数据类型 | 为 -1 时, 等同于选中的id数组 |
| mark | '' | 操作标示, 可传字符串或对象 | 为字符串将自动转换为对象, 对象键为 mark |